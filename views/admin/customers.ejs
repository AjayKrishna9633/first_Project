<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GearGrid - Customers</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/public/css/text-wrap.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        .toggle-switch {
            position: relative;
            width: 46px;
            height: 25px;
            display: inline-block;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #dc2626;
            transition: 0.3s;
            border-radius: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        .toggle-slider:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 18px;
            left: 0px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        input:checked + .toggle-slider {
            background-color: #16a34a;
        }
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        .toggle-switch:active .toggle-slider:before {
            width: 28px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
       
    
            <%- include('../partials/adminHeader', { admin: admin }) %>

    <div class="flex">
        <!-- Sidebar -->
   
        <%- include('../partials/adminSidebar', { currentPage: 'customers' }) %>

        <!-- Main Content -->
        <main class="flex-1 p-8">
            <!-- Breadcrumb -->
            <div class="flex items-center text-sm text-gray-600 mb-8">
                <span>Admin</span>
                <i class="fas fa-chevron-right mx-2 text-xs"></i>
                <span class="text-gray-900">Customers</span>
            </div>

            <!-- Customers Section -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold">Customers</h2>
                    <div class="relative">
                       <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-semibold"></h2>
    <form method="GET" action="/admin/customers" class="flex gap-2">
        <div class="relative">
            <input 
                type="text" 
                name="search"
                value="<%= search %>"
                placeholder="Search customers" 
                class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 w-64"
            >
            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
        </div>
        <select 
            name="status" 
            class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
            <option value="all" <%= status === 'all' ? 'selected' : '' %>>All Status</option>
            <option value="active" <%= status === 'active' ? 'selected' : '' %>>Active</option>
            <option value="blocked" <%= status === 'blocked' ? 'selected' : '' %>>Blocked</option>
        </select>
        <button 
            type="submit"
            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
        >
            Search
        </button>
    </form>
</div>
 </div>
                </div>

                <!-- Table -->
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200">
                                <th class="text-left py-4 px-4 font-medium text-gray-700 text-sm">Name</th>
                                <th class="text-left py-4 px-4 font-medium text-gray-700 text-sm">Email</th>
                                <th class="text-left py-4 px-4 font-medium text-gray-700 text-sm">Mobile</th>
                                <th class="text-left py-4 px-4 font-medium text-gray-700 text-sm">Status</th>
                                <th class="text-left py-4 px-4 font-medium text-gray-700 text-sm">Join Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if(customers.length === 0) { %>
                            <tr>
                                <td colspan="5" class="py-8 px-4 text-center text-gray-500">
                                No customers found
                                </td>
                            </tr>
                           <% } else { %>
                            
                            <% customers.forEach(customer => { %>
                                 <tr class="border-b border-gray-100 hover:bg-gray-50">
                <td class="py-4 px-4">
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-sm font-medium mr-3">
                            <%= customer.fullName.substring(0, 2).toUpperCase() %>
                        </div>
                        <span class="text-gray-900"><%= customer.fullName %></span>
                    </div>
                </td>
                <td class="py-4 px-4 text-gray-700"><%= customer.email %></td>
                <td class="py-4 px-4 text-gray-700"><%= customer.phone || 'N/A' %></td>
                <td class="py-4 px-4">
                    <label class="toggle-switch">
                        <input 
                            type="checkbox" 
                            <%= customer.isBlocked ? '' : 'checked' %>
                            onchange="toggleBlock('<%= customer._id %>', this.checked, event)"
                        >
                        <span class="toggle-slider"></span>
                    </label>
                </td>
                <td class="py-4 px-4 text-gray-700">
                    <%= new Date(customer.createdOn).toLocaleDateString() %>
                </td>
            </tr>
                           <% }); %>
                           <% } %>
                        
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
<% if (totalPages > 1) { %>
    <div class="flex justify-center items-center mt-6 space-x-2">
        <!-- Previous Button -->
        <% if (currentPage > 1) { %>
            <a href="/admin/customers?page=<%= currentPage - 1 %>&search=<%= search %>&status=<%= status %>" 
               class="px-3 py-1 text-gray-600 hover:bg-gray-100 rounded">
                <i class="fas fa-chevron-left"></i>
            </a>
        <% } %>
        
        <!-- Page Numbers -->
        <% for (let i = 1; i <= totalPages; i++) { %>
            <% if (i === currentPage) { %>
                <button class="px-3 py-1 bg-blue-600 text-white rounded"><%= i %></button>
            <% } else if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) { %>
                <a href="/admin/customers?page=<%= i %>&search=<%= search %>&status=<%= status %>" 
                   class="px-3 py-1 text-gray-600 hover:bg-gray-100 rounded">
                    <%= i %>
                </a>
            <% } else if (i === currentPage - 2 || i === currentPage + 2) { %>
                <span class="px-3 py-1 text-gray-600">...</span>
            <% } %>
        <% } %>
        
        <!-- Next Button -->
        <% if (currentPage < totalPages) { %>
            <a href="/admin/customers?page=<%= currentPage + 1 %>&search=<%= search %>&status=<%= status %>" 
               class="px-3 py-1 text-gray-600 hover:bg-gray-100 rounded">
                <i class="fas fa-chevron-right"></i>
            </a>
        <% } %>
    </div>
<% } %>

            </div>
        </main>
    </div>
    <script src="/public/admin/toggleButton.js"></script>
</body>
</html>
